<%- include('../layouts/adminHeader.ejs') %>


<main class="main-wrap">
    <header class="main-header navbar">
        <div class="col-search">
            <form class="searchform">
                <div class="input-group">
                    <input list="search_terms" type="text" class="form-control" placeholder="Search term">
                    <button class="btn btn-light bg" type="button"> <i
                            class="material-icons md-search"></i></button>
                </div>
                <datalist id="search_terms">
                    <option value="Products">
                    <option value="New orders">
                    <option value="Apple iphone">
                    <option value="Ahmed Hassan">
                </datalist>
            </form>
        </div>
        <div>
            <a href="/admin" class="btn btn-primary">Logout</a>
          </div>
    </header>

    
    <div class="container mt-3">
        <div class="row" >
            <div class="col-md-2"style="padding-top: 27px;" >
                <a href="/admin/salesReport/download/xlsx" class="btn btn-primary">Download</a>
            </div>

            <% if (dateValues) { %>
                <div class="col-md-2">
                    <label for="startDate" class="form-label">From:</label>
                    <input id="startDate" type="date" class="form-control" value="<%= dateValues.startDate %>">
                </div>

                <div class="col-md-2">
                    <label for="endDate" class="form-label">To:</label>
                    <input id="endDate" type="date" class="form-control" value="<%= dateValues.endDate %>">
                </div>

                <% } else { %>

                    <div class="col-md-2">
                        <label for="startDate" class="form-label">From:</label>
                        <input id="startDate" type="date" class="form-control">
                    </div>

                    <div class="col-md-2">
                        <label for="endDate" class="form-label">To:</label>
                        <input id="endDate" type="date" class="form-control">
                    </div>

                    <% } %>

                    <div class="col-md-2" style="padding-top: 27px;">
                        <button id="filterBtn" class="btn btn-success">Filter</button>
                    </div>
                </div>
            </div>
<br>
<br>

    <div class="container pt-3">
        <table id="example" class="table table-striped table-bordered" style="width:100%">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Order No</th>
                    <th scope="col">Products</th>
                    <th scope="col">No. of Items</th>
                    <th scope="col">Total Cost</th>
                    <th scope="col">Payment Method</th>
                    <th scope="col">Status</th>
                </tr>
            </thead>
            
            <tbody>
                <% salesData.reverse().forEach(function(sale, index) { %>
                    <tr>
                        <td>
                            <%= index + 1 %>
                        </td>
                        <td>
                            <%= sale.orderNumber %>

                        </td>
                       
                        <td>
                            <ul>
                                <% sale.cartData.forEach(function(cartItem) { %>
                                    <li>
                                        <%= cartItem.productId.productName %>
                                    </li>
                                    <% }) %>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <% sale.cartData.forEach(function(cartItem) { %>
                                    <li>
                                        <%= cartItem.productQuantity %>
                                    </li>
                                    <% }) %>
                            </ul>
                        </td>
                        <td>â‚¹<%= sale.grandTotalCost %>
                        </td>
                        <td>
                            <%= sale.paymentType %>
                        </td>
                        <td>
                            <%= sale.orderStatus %>
                        </td>
                    </tr>
                    <% }) %>
            </tbody>
            
        </table>
       

        


        <script>
            let startDate = document.getElementById('startDate')
            let endDate = document.getElementById('endDate')

            startDate.addEventListener('change', function () {
                let startDateValue = startDate.value;
                endDate.setAttribute('min', startDateValue);
            });

            endDate.addEventListener('change', function () {
                let endDateValue = endDate.value;
                startDate.setAttribute('max', endDateValue);
            });

        </script>


        <script>
            let filterBtn = document.getElementById('filterBtn')
            filterBtn.addEventListener('click', async (e) => {
                e.preventDefault()
                let startDate = document.getElementById('startDate').value
                let endDate = document.getElementById('endDate').value
                let formData = { startDate, endDate }
                console.log(formData)

                let response = await fetch('/admin/salesReport/filter',
                    {
                        method: 'POST',
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(formData)
                    })
                let result = await response.json()

                if (result.success) {
                    console.log('hello')
                    location.reload()
                }
            })
        </script>




<%- include('../layouts/adminFooter.ejs') %>
